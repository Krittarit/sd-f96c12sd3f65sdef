--[[
    Roblox Smart Trade Trigger Script (Luau) - Time-Based Trading
    ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ trade ‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    
    ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
    - Trade Start: 16:00 (4 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô) GMT+7
    - Trade Stop: ‡∏´‡∏•‡∏±‡∏á 17:00 (5 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô) GMT+7
    
    ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
    1. ‡πÄ‡∏õ‡∏¥‡∏î Roblox Executor
    2. Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á
    3. ‡∏Å‡∏î Execute
    4. ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
]]

-- Configuration
local CHECK_INTERVAL = 30 -- ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
local GMT_OFFSET = 7 -- GMT+7 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢
local TRADE_START_HOUR = 10 -- 10 ‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤
local TRADE_END_HOUR = 13 -- 1 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô
local MIN_COINS_THRESHOLD = 5000 -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô trade stop

-- Place IDs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ join
local TRADE_START_PLACE_ID = 14119723130
local TRADE_STOP_PLACE_ID = 5233782396

-- Loadstring URLs
local TRADE_START_LOADSTRING = "https://raw.githubusercontent.com/Krittarit/sd-f96c12sd3f65sdef/refs/heads/main/tragicG"
local TRADE_STOP_LOADSTRING = "https://api.luarmor.net/files/v3/loaders/008bf699b44dd5a7d35d683c3e0805aa.lua"

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
local current_trade_mode = nil -- "start" ‡∏´‡∏£‡∏∑‡∏≠ "stop"
local last_action_time = 0
local ACTION_COOLDOWN = 10 -- ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)

-- ‡πÉ‡∏ä‡πâ HttpService ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö decode JSON
local HttpService = game:GetService("HttpService")

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô console
local function printToConsole(message)
    print("[" .. os.date("%H:%M:%S") .. "] " .. message)
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local function getCurrentPlaceId()
    local success, result = pcall(function()
        return game.PlaceId
    end)
    if success then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ: " .. tostring(result))
        return nil
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô GMT+7 (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà)
local function getCurrentTimeGMT7()
    local success, result = pcall(function()
        -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ DateTime.now() ‡∏Ç‡∏≠‡∏á Roblox (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
        local utcDateTime = DateTime.now()
        local gmt7Timestamp = utcDateTime.UnixTimestamp + (GMT_OFFSET * 3600) -- +7 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
        local gmt7DateTime = DateTime.fromUnixTimestamp(gmt7Timestamp)
        
        return {
            year = gmt7DateTime.Year,
            month = gmt7DateTime.Month,
            day = gmt7DateTime.Day,
            hour = gmt7DateTime.Hour,
            min = gmt7DateTime.Minute,
            sec = gmt7DateTime.Second
        }
    end)
    
    if success then
        return result
    else
        -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ HTTP API ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ñ‡πâ‡∏≤ DateTime ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        local api_success, api_result = pcall(function()
            local HttpService = game:GetService("HttpService")
            local response = HttpService:GetAsync("http://worldtimeapi.org/api/timezone/Asia/Bangkok")
            local data = HttpService:JSONDecode(response)
            
            -- Parse datetime string (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: 2024-01-01T16:30:45.123456+07:00)
            local datetime_str = data.datetime
            local year, month, day, hour, min, sec = string.match(datetime_str, "(%d+)-(%d+)-(%d+)T(%d+):(%d+):(%d+)")
            
            return {
                year = tonumber(year),
                month = tonumber(month),
                day = tonumber(day),
                hour = tonumber(hour),
                min = tonumber(min),
                sec = tonumber(sec)
            }
        end)
        
        if api_success then
            printToConsole("‚ö†Ô∏è ‡πÉ‡∏ä‡πâ API ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (DateTime ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)")
            return api_result
        else
            -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
            local fallback_success, fallback_result = pcall(function()
                local utc_time = os.time()
                local gmt7_time = utc_time + (GMT_OFFSET * 3600)
                return os.date("*t", gmt7_time)
            end)
            
            if fallback_success then
                printToConsole("‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á 100%)")
                return fallback_result
            else
                printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ: " .. tostring(result))
                return nil
            end
        end
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤
local function validateTimeAccuracy()
    local success, result = pcall(function()
        printToConsole("üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤...")
        
        -- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö DateTime.now()
        local dt_success, dt_time = pcall(function()
            local utcDateTime = DateTime.now()
            local gmt7Timestamp = utcDateTime.UnixTimestamp + (GMT_OFFSET * 3600)
            local gmt7DateTime = DateTime.fromUnixTimestamp(gmt7Timestamp)
            return string.format("%02d:%02d:%02d", gmt7DateTime.Hour, gmt7DateTime.Minute, gmt7DateTime.Second)
        end)
        
        -- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API
        local api_success, api_time = pcall(function()
            local HttpService = game:GetService("HttpService")
            local response = HttpService:GetAsync("http://worldtimeapi.org/api/timezone/Asia/Bangkok")
            local data = HttpService:JSONDecode(response)
            local datetime_str = data.datetime
            local hour, min, sec = string.match(datetime_str, "T(%d+):(%d+):(%d+)")
            return string.format("%02d:%02d:%02d", tonumber(hour), tonumber(min), tonumber(sec))
        end)
        
        -- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö os.time()
        local os_time = os.date("!%H:%M:%S")
        
        printToConsole("üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:")
        if dt_success then
            printToConsole("   DateTime (GMT+7): " .. dt_time)
        else
            printToConsole("   DateTime: ‚ùå ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        end
        
        if api_success then
            printToConsole("   API (GMT+7): " .. api_time)
        else
            printToConsole("   API: ‚ùå ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        end
        
        printToConsole("   OS Time (UTC): " .. os_time)
        printToConsole("   üìå ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ DateTime ‡∏´‡∏£‡∏∑‡∏≠ API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á")
        
        return true
    end)
    
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö string
local function formatTime(time_table)
    if not time_table then return "N/A" end
    return string.format("%02d:%02d:%02d", time_table.hour, time_table.min, time_table.sec)
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ trade start ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
local function isTradeStartTime()
    local current_time = getCurrentTimeGMT7()
    if not current_time then return false end
    
    local current_hour = current_time.hour
    
    -- Trade Start: 16:00-16:59 (4 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô ‡∏ñ‡∏∂‡∏á‡∏Å‡πà‡∏≠‡∏ô 5 ‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô)
    if current_hour >= TRADE_START_HOUR and current_hour < TRADE_END_HOUR then
        return true
    else
        return false
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
local function getCurrentCoins()
    local success, result = pcall(function()
        local players = game:GetService("Players")
        local localPlayer = players.LocalPlayer
        
        -- ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà
        local coins = nil
        
        -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: players.Data.Coins.Value
        if players.Data and players.Data.Coins and players.Data.Coins.Value then
            coins = players.Data.Coins.Value
        -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: LocalPlayer.Data.Coins.Value  
        elseif localPlayer.Data and localPlayer.Data.Coins and localPlayer.Data.Coins.Value then
            coins = localPlayer.Data.Coins.Value
        -- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: leaderstats
        elseif localPlayer.leaderstats and localPlayer.leaderstats.Coins and localPlayer.leaderstats.Coins.Value then
            coins = localPlayer.leaderstats.Coins.Value
        end
        
        return coins
    end)
    
    if success and result then
        return result
    else
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏î‡πâ: " .. tostring(result))
        return nil
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ô trade stop ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
local function shouldRunTradeStop()
    local coins = getCurrentCoins()
    if coins == nil then
        printToConsole("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡∏£‡∏±‡∏ô trade stop ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥")
        return true
    end
    
    printToConsole("üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " .. tostring(coins))
    
    if coins < MIN_COINS_THRESHOLD then
        printToConsole("üìâ ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á " .. MIN_COINS_THRESHOLD .. " ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô trade stop")
        return true
    else
        printToConsole("üíé ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ " .. MIN_COINS_THRESHOLD .. " ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô trade stop")
        return false
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö join place
local function joinPlace(placeId, reason)
    local success, result = pcall(function()
        printToConsole("üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á join place ID: " .. placeId .. " (" .. reason .. ")")
        local TeleportService = game:GetService("TeleportService")
        TeleportService:Teleport(placeId)
        printToConsole("‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ join place ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ join place ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö place 14119723130)
local function warpToPosition()
    local success, result = pcall(function()
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character then
            printToConsole("üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î...")
            character:PivotTo(CFrame.new(Vector3.new(-2132.24, 490.66, 1106.83)))
            printToConsole("‚úÖ ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (-2132.24, 490.66, 1106.83)")
        else
            printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Character ‡∏Ç‡∏≠‡∏á LocalPlayer")
        end
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô Trade Start Script
local function runTradeStartScript()
    local success, result = pcall(function()
        printToConsole("üìú ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô Trade Start Script...")
        loadstring(game:HttpGet(TRADE_START_LOADSTRING))()
        printToConsole("‚úÖ ‡∏£‡∏±‡∏ô Trade Start Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Trade Start Script ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô Trade Stop Script
local function runTradeStopScript()
    local success, result = pcall(function()
        printToConsole("üìú ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô Trade Stop Script...")
        loadstring(game:HttpGet(TRADE_STOP_LOADSTRING))()
        printToConsole("‚úÖ ‡∏£‡∏±‡∏ô Trade Stop Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    end)
    if not success then
        printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô Trade Stop Script ‡πÑ‡∏î‡πâ: " .. tostring(result))
    end
end

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ trade mode ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
local function checkAndManageTradeByTime()
    local success, error_msg = pcall(function()
        local current_time = getCurrentTimeGMT7()
        local current_place_id = getCurrentPlaceId()
        local now = tick()
        
        if not current_time then
            printToConsole("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏î‡πâ")
            return
        end
        
        local time_str = formatTime(current_time)
        printToConsole("üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (GMT+7): " .. time_str)
        printToConsole("üìç Place ID ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " .. tostring(current_place_id))
        
        local new_trade_mode = nil
        local is_trade_time = isTradeStartTime()
        
        -- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î trade mode ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
        if is_trade_time then
            new_trade_mode = "start"
        else
            new_trade_mode = "stop"
        end
        
        -- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á trade mode ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if new_trade_mode ~= current_trade_mode then
            printToConsole("üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Trade Mode ‡∏à‡∏≤‡∏Å '" .. tostring(current_trade_mode) .. "' ‡πÄ‡∏õ‡πá‡∏ô '" .. new_trade_mode .. "'")
            current_trade_mode = new_trade_mode
            last_action_time = now -- Reset cooldown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô mode
        end
        
        -- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏° trade mode ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        if current_trade_mode == "start" then
            printToConsole("‚ñ∂Ô∏è Trade Start Mode: ‡πÄ‡∏ß‡∏•‡∏≤ " .. TRADE_START_HOUR .. ":00-" .. TRADE_END_HOUR .. ":00 GMT+7")
            
            if current_place_id == TRADE_START_PLACE_ID then
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Start Place ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏±‡∏ô script ‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏£‡πå‡∏õ
                if now - last_action_time > ACTION_COOLDOWN then
                    runTradeStartScript()
                    warpToPosition()
                    last_action_time = now
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                end
            elseif current_place_id == TRADE_STOP_PLACE_ID then
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Stop Place ‡∏ï‡πâ‡∏≠‡∏á join ‡πÑ‡∏õ Trade Start Place
                if now - last_action_time > ACTION_COOLDOWN then
                    printToConsole("üîÑ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Trade ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ Trade Start Place")
                    joinPlace(TRADE_START_PLACE_ID, "Trade Start - ‡πÄ‡∏ß‡∏•‡∏≤ " .. time_str)
                    last_action_time = now
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                end
            else
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô place ‡∏≠‡∏∑‡πà‡∏ô join ‡πÑ‡∏õ Trade Start Place
                if now - last_action_time > ACTION_COOLDOWN then
                    printToConsole("üîÑ ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô place ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ Trade Start Place")
                    joinPlace(TRADE_START_PLACE_ID, "Trade Start - Unknown Place")
                    last_action_time = now
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                end
            end
            
        elseif current_trade_mode == "stop" then
            printToConsole("üõë Trade Stop Mode: ‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ " .. TRADE_START_HOUR .. ":00-" .. TRADE_END_HOUR .. ":00 GMT+7")
            
            if current_place_id == TRADE_STOP_PLACE_ID then
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Stop Place ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô script
                if now - last_action_time > ACTION_COOLDOWN then
                    -- ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç
                    if shouldRunTradeStop() then
                        runTradeStopScript()
                        last_action_time = now
                    else
                        printToConsole("üí∞ ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ô Trade Stop Script")
                        last_action_time = now -- Reset cooldown ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
                    end
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                end
            elseif current_place_id == TRADE_START_PLACE_ID then
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Trade Start Place ‡∏ï‡πâ‡∏≠‡∏á join ‡πÑ‡∏õ Trade Stop Place
                if now - last_action_time > ACTION_COOLDOWN then
                    printToConsole("üîÑ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ Trade ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Trade Stop Place")
                    joinPlace(TRADE_STOP_PLACE_ID, "Trade Stop - ‡πÄ‡∏ß‡∏•‡∏≤ " .. time_str)
                    last_action_time = now
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                end
            else
                -- ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô place ‡∏≠‡∏∑‡πà‡∏ô join ‡πÑ‡∏õ Trade Stop Place
                if now - last_action_time > ACTION_COOLDOWN then
                    printToConsole("üîÑ ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô place ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ Trade Stop Place")
                    joinPlace(TRADE_STOP_PLACE_ID, "Trade Stop - Unknown Place")
                    last_action_time = now
                else
                    printToConsole("‚è≥ Cooldown: ‡∏£‡∏≠ " .. math.ceil(ACTION_COOLDOWN - (now - last_action_time)) .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
                end
            end
        end
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        local next_change_time = ""
        if is_trade_time then
            next_change_time = " (‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤ " .. TRADE_END_HOUR .. ":00)"
        else
            next_change_time = " (‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤ " .. TRADE_START_HOUR .. ":00)"
        end
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î stop
        local coin_status = ""
        if current_trade_mode == "stop" and current_place_id == TRADE_STOP_PLACE_ID then
            local coins = getCurrentCoins()
            if coins then
                coin_status = " | ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: " .. coins .. "/" .. MIN_COINS_THRESHOLD
            end
        end
        
        printToConsole("üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " .. (current_trade_mode == "start" and "‚ñ∂Ô∏è Trading" or "üõë Stopped") .. 
                      " | ‡πÄ‡∏ß‡∏•‡∏≤: " .. time_str .. next_change_time .. coin_status)
        printToConsole("----------------------------------------")
    end)
    
    if not success then
        printToConsole("‚ùå [ERROR] Error in checkAndManageTradeByTime: " .. tostring(error_msg))
    end
end

-- Main Loop
local function mainLoop()
    local success, error_msg = pcall(function()
        printToConsole("üöÄ Roblox Time-Based Trade Script Started!")
        printToConsole("‚è±Ô∏è  Check interval: " .. CHECK_INTERVAL .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("üåè Time Zone: GMT+" .. GMT_OFFSET .. " (‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢)")
        printToConsole("üïê Action Cooldown: " .. ACTION_COOLDOWN .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("")
        printToConsole("üéØ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:")
        printToConsole("   ‚ñ∂Ô∏è Trade Start: " .. TRADE_START_HOUR .. ":00-" .. TRADE_END_HOUR .. ":00 GMT+7 ‚Üí Place ID: " .. TRADE_START_PLACE_ID)
        printToConsole("   üõë Trade Stop:  ‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß ‚Üí Place ID: " .. TRADE_STOP_PLACE_ID)
        printToConsole("   üí∞ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: ‡∏£‡∏±‡∏ô Trade Stop ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç < " .. MIN_COINS_THRESHOLD)
        printToConsole("")
        printToConsole("üí° ‡∏£‡∏∞‡∏ö‡∏ö Smart:")
        printToConsole("   - ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏∏‡∏Å " .. CHECK_INTERVAL .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        printToConsole("   - ‡πÄ‡∏ä‡πá‡∏Ñ place id ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô join")
        printToConsole("   - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô Trade Stop")
        printToConsole("   - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡∏î‡πâ‡∏ß‡∏¢ cooldown")
        printToConsole("   - ‡∏£‡∏±‡∏ô loadstring ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥")
        printToConsole("   - ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô Trade Start Place")
        printToConsole("")
        printToConsole("üõ°Ô∏è  ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô:")
        printToConsole("   - ‡πÉ‡∏ä‡πâ pcall ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        printToConsole("   - Cooldown " .. ACTION_COOLDOWN .. " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ã‡πâ‡∏≥")
        printToConsole("   - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô console ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
        printToConsole("----------------------------------------")
        
        -- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤
        validateTimeAccuracy()
        printToConsole("----------------------------------------")
        
        -- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        local current_time = getCurrentTimeGMT7()
        if current_time then
            printToConsole("üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (GMT+7): " .. formatTime(current_time))
            if isTradeStartTime() then
                printToConsole("üü¢ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Trade!")
            else
                printToConsole("üî¥ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Trade")
            end
        end
        printToConsole("----------------------------------------")
        
        -- Main loop
        while true do
            local loop_success, loop_error = pcall(function()
                -- ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ trade ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
                checkAndManageTradeByTime()
                
                wait(CHECK_INTERVAL)
            end)
            
            if not loop_success then
                printToConsole("‚ùå [ERROR] Error in main loop: " .. tostring(loop_error))
                printToConsole("üîÑ Restarting loop in 5 seconds...")
                wait(5)
            end
        end
    end)
    
    if not success then
        printToConsole("‚ùå [CRITICAL ERROR] Script failed to start: " .. tostring(error_msg))
    end
end

-- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå
mainLoop() 
