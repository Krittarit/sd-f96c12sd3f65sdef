-- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Player ‡πÅ‡∏•‡∏∞ Services
local player = game:GetService("Players").LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local data = playerGui:WaitForChild("Data")
local coinsObj = data:WaitForChild("Coins")
local Lighting = game:GetService("Lighting")

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö error handling
local dataConnected = true

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Death Points (‡∏ô‡∏≥‡∏°‡∏≤‡∏à‡∏≤‡∏Å caldeathstat.lua)
local function safeGetValue(object, defaultValue)
    if object and object.Value ~= nil then
        return object.Value
    end
    return defaultValue or 0
end

local function safeToString(value)
    if type(value) == "string" then
        return value
    elseif type(value) == "number" then
        return tostring(value)
    elseif type(value) == "userdata" and value.Name then
        return value.Name
    else
        return tostring(value)
    end
end

local function calculateDeathPoints()
    -- Debug: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
    print("üî• ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Death Points üî•")
    
    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    if not player or not player.Settings or not player.Settings.Slot then
        print("‚ùå Error: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô")
        return 0
    end
    
    if not playerGui or not playerGui.Data then
        print("‚ùå Error: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PlayerGui")
        return 0
    end
    
    -- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Slot ‡πÅ‡∏•‡∏∞ DeathStats
    local currentSlotRaw = player.Settings.Slot.Value
    local currentSlot = safeToString(currentSlotRaw)
    print("üìç Current Slot: " .. currentSlot)
    
    local slotData = playerGui.Data:FindFirstChild(currentSlot) or playerGui.Data[currentSlot]
    
    if not slotData then
        print("‚ùå Error: ‡πÑ‡∏°‡πà‡∏û‡∏ö " .. currentSlot)
        return 0
    end
    
    local deathStats = slotData:FindFirstChild("DeathStats")
    if not deathStats then
        print("‚ùå Error: ‡πÑ‡∏°‡πà‡∏û‡∏ö DeathStats")
        return 0
    end
    
    print("‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö " .. currentSlot)
    
    local totalPoints = 0
    
    -- 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Growth Stages
    local growthPoints = 0
    local adultValue = safeGetValue(deathStats:FindFirstChild("GrowCreatureAdult"), 0)
    local teenValue = safeGetValue(deathStats:FindFirstChild("GrowCreatureTeen"), 0)
    
    if adultValue == 1 then growthPoints = growthPoints + 7.5 end
    if teenValue == 1 then growthPoints = growthPoints + 7.5 end
    totalPoints = totalPoints + growthPoints
    
    -- 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Missions Completed
    local missionsCompleted = safeGetValue(deathStats:FindFirstChild("MissionsCompleted"), 0)
    local missionPoints = missionsCompleted * 4
    totalPoints = totalPoints + missionPoints
    
    -- 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Disasters Survived
    local disastersSurvived = safeGetValue(deathStats:FindFirstChild("DisastersSurvived"), 0)
    local disasterPoints = disastersSurvived * 6
    totalPoints = totalPoints + disasterPoints
    
    -- 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Time Played
    local timePlayed = safeGetValue(deathStats:FindFirstChild("TimePlayed"), 0)
    local timePoints = math.floor(timePlayed / 210)
    totalPoints = totalPoints + timePoints
    
    -- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏ß‡∏°
    print("üå± Growth Stages: " .. growthPoints .. " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô")
    print("üéØ Missions Completed: " .. missionPoints .. " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô")
    print("üå™Ô∏è Disasters Survived: " .. disasterPoints .. " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô")
    print("‚è∞ Time Played: " .. timePoints .. " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô")
    print("üéâ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: " .. totalPoints .. " Death Points üéâ")
    
    return totalPoints
end

-- üñ§ ‡∏™‡∏£‡πâ‡∏≤‡∏á GUI ‡∏•‡∏î CPU ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô üñ§ --
local screenGui = Instance.new("ScreenGui")
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = playerGui

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏î‡∏≥
local blackFrame = Instance.new("Frame")
blackFrame.Size = UDim2.new(1, 0, 1, 0)
blackFrame.Position = UDim2.new(0, 0, 0, 0)
blackFrame.BackgroundColor3 = Color3.new(0, 0, 0)
blackFrame.ZIndex = 10
blackFrame.Parent = screenGui

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á Container Frame ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
local mainContainer = Instance.new("Frame")
mainContainer.Size = UDim2.new(0.9, 0, 0.7, 0)
mainContainer.Position = UDim2.new(0.05, 0, 0.15, 0)
mainContainer.BackgroundTransparency = 1
mainContainer.ZIndex = 11
mainContainer.Parent = screenGui

-- üéÆ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î)
local playerNameLabel = Instance.new("TextLabel")
playerNameLabel.Size = UDim2.new(1, 0, 0.15, 0)
playerNameLabel.Position = UDim2.new(0, 0, 0, 0)
playerNameLabel.BackgroundTransparency = 1
playerNameLabel.TextColor3 = Color3.new(0, 1, 1) -- ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô
playerNameLabel.Font = Enum.Font.SourceSansBold
playerNameLabel.TextScaled = true
playerNameLabel.Text = "üéÆ " .. player.Name
playerNameLabel.ZIndex = 12
playerNameLabel.Parent = mainContainer

-- ‚òÑÔ∏è ‡∏¢‡∏≠‡∏î GAE (‡πÄ‡∏´‡πá‡∏î)
local shoomsLabel = Instance.new("TextLabel")
shoomsLabel.Size = UDim2.new(1, 0, 0.2, 0)
shoomsLabel.Position = UDim2.new(0, 0, 0.2, 0)
shoomsLabel.BackgroundTransparency = 1
shoomsLabel.TextColor3 = Color3.new(1, 1, 0) -- ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
shoomsLabel.Font = Enum.Font.SourceSansBold
shoomsLabel.TextScaled = true
shoomsLabel.Text = "‚òÑÔ∏è GAE: 0"
shoomsLabel.ZIndex = 12
shoomsLabel.Parent = mainContainer

-- [DP] Death Points
local deathPointsLabel = Instance.new("TextLabel")
deathPointsLabel.Size = UDim2.new(1, 0, 0.2, 0)
deathPointsLabel.Position = UDim2.new(0, 0, 0.45, 0)
deathPointsLabel.BackgroundTransparency = 1
deathPointsLabel.TextColor3 = Color3.new(1, 0.5, 0) -- ‡∏™‡∏µ‡∏™‡πâ‡∏°
deathPointsLabel.Font = Enum.Font.SourceSansBold
deathPointsLabel.TextScaled = true
deathPointsLabel.Text = "[DP] DeathPoints: 0"
deathPointsLabel.ZIndex = 12
deathPointsLabel.Parent = mainContainer

-- ‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
local timeLabel = Instance.new("TextLabel")
timeLabel.Size = UDim2.new(1, 0, 0.1, 0)
timeLabel.Position = UDim2.new(0, 0, 0.7, 0)
timeLabel.BackgroundTransparency = 1
timeLabel.TextColor3 = Color3.new(0.5, 1, 0.5) -- ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô
timeLabel.Font = Enum.Font.SourceSansBold
timeLabel.TextScaled = true
timeLabel.Text = "‚è≥ Online: 00:00:00"
timeLabel.ZIndex = 12
timeLabel.Parent = mainContainer

-- üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Game Time)
local currentTimeLabel = Instance.new("TextLabel")
currentTimeLabel.Size = UDim2.new(1, 0, 0.1, 0)
currentTimeLabel.Position = UDim2.new(0, 0, 0.82, 0)
currentTimeLabel.BackgroundTransparency = 1
currentTimeLabel.TextColor3 = Color3.new(0.8, 0.8, 1) -- ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô
currentTimeLabel.Font = Enum.Font.SourceSansBold
currentTimeLabel.TextScaled = true
currentTimeLabel.Text = "üïê Game Time: 00:00:00"
currentTimeLabel.ZIndex = 12
currentTimeLabel.Parent = mainContainer

-- ‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á (‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡∏±‡πà‡∏ô)
local decorLine1 = Instance.new("Frame")
decorLine1.Size = UDim2.new(0.8, 0, 0.005, 0)
decorLine1.Position = UDim2.new(0.1, 0, 0.17, 0)
decorLine1.BackgroundColor3 = Color3.new(1, 1, 1)
decorLine1.BorderSizePixel = 0
decorLine1.ZIndex = 12
decorLine1.Parent = mainContainer

local decorLine2 = Instance.new("Frame")
decorLine2.Size = UDim2.new(0.8, 0, 0.005, 0)
decorLine2.Position = UDim2.new(0.1, 0, 0.68, 0)
decorLine2.BackgroundColor3 = Color3.new(1, 1, 1)
decorLine2.BorderSizePixel = 0
decorLine2.ZIndex = 12
decorLine2.Parent = mainContainer

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
local startTime = tick()
local initialShooms = coinsObj and coinsObj.Value or 0
local lastShooms = initialShooms
local lastUpdateTime = tick()
local previousShooms = initialShooms

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
local function updateAllData()
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
    local elapsedTime = tick() - startTime
    local hours = math.floor(elapsedTime / 3600)
    local minutes = math.floor((elapsedTime % 3600) / 60)
    local seconds = math.floor(elapsedTime % 60)
    timeLabel.Text = string.format("‚è≥ Online: %02d:%02d:%02d", hours, minutes, seconds)
    
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á Roblox)
    local currentGameTime = os.date("*t") -- ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö Roblox ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
    currentTimeLabel.Text = string.format("üïê Game Time: %02d:%02d:%02d", currentGameTime.hour, currentGameTime.min, currentGameTime.sec)

    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î GAE (Shooms)
    local currentShooms = coinsObj and coinsObj.Value or 0
    local shoomsDifference = currentShooms - initialShooms
    
    -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Shooms ‡∏ï‡πà‡∏≠ loop (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    local currentTick = tick()
    local timeSinceLastUpdate = currentTick - lastUpdateTime
    local shoomsGained = currentShooms - previousShooms
    local shoomsPerLoop = 0
    
    if timeSinceLastUpdate > 0 and shoomsGained > 0 then
        -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô shooms ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô loop ‡∏ô‡∏µ‡πâ (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
        shoomsPerLoop = (shoomsGained / timeSinceLastUpdate) * 30 -- ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πà‡∏≠ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    end
    
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö loop ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
    lastUpdateTime = currentTick
    previousShooms = currentShooms

    if shoomsDifference > 0 then
        shoomsLabel.Text = string.format("‚òÑÔ∏è GAE: %d (+%d) | %.1f/loop", currentShooms, shoomsDifference, shoomsPerLoop)
    else
        shoomsLabel.Text = string.format("‚òÑÔ∏è GAE: %d | 0.0/loop", currentShooms)
    end
    
    -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Death Points
    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    local playerInGame = game.Workspace.Characters:FindFirstChild(player.Name)
    
    if not playerInGame then
        deathPointsLabel.Text = "[DP] ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏°"
    else
        local success, deathPoints = pcall(calculateDeathPoints)
        if success then
            deathPointsLabel.Text = string.format("[DP] DeathPoints: %d", deathPoints)
        else
            deathPointsLabel.Text = "[DP] DeathPoints: Error"
            print("‚ùå Death Points Error: " .. tostring(deathPoints))
        end
    end
end

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
local success, error = pcall(updateAllData)
if not success then
    print("‚ùå Initial Update Error: " .. tostring(error))
end

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
while true do
    wait(60) -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ shooms/loop ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    local success, error = pcall(updateAllData)
    if not success then
        print("‚ùå Update Error: " .. tostring(error))
    end
end
